---
date: 2025-08-16 13:02:11
permalink: /tech/mysql/sqladvisor
categories:
  - MySQL
tags:
  - MySQL
---

# SQL优化工具SQLAdvisor

## 什么是索引?

```
打个比方，我们在使用MySQL用作查询的时候就好比查字典，索引就好比字典的偏旁部首页。
如果没有索引我们查询一个文字就需要一页页的翻，显然这种方式效率很低。
如果我们对某一字段加入了索引，就可以通过偏旁部首页查找这个文字，让查询变得更加高效
```

> 效果展示

- 下载测试sql文件 链接：<https://pan.baidu.com/s/1dEBroLr> 密码：u6vr
- 执行sql语句(耗时34秒左右`linux系统下的测试`)

```txt
SELECT ca_id,
       sub_id,
       ca_number,
       sub_number
FROM tbl_category ca
         LEFT JOIN tbl_subcategory sub ON ca.ca_number = sub.sub_number
```

![执行SQL结果](http://s.siushin.com/siushin/upload/mysql/1631104906157.png)

## 使用SQL优化工具

```shell
[root@localhost /]# /usr/sbin/sqladvisor -f /etc/sql.cnf -q "SELECT ca_id, sub_id, ca_number, sub_number FROM tbl_category ca LEFT JOIN tbl_subcategory sub ON ca.ca_number = sub.sub_number" -v 1

2021-09-08 20:47:36 3494 [Note] 第1步: 对SQL解析优化之后得到的SQL:select `ca_id` AS `ca_id`,`sub_id` AS `sub_id`,`ca_number` AS `ca_number`,`sub_number` AS `sub_number` from (`test`.`tbl_category` `ca` left join `test`.`tbl_subcategory` `sub` on((`ca`.`ca_number` = `sub`.`sub_number`))) 

2021-09-08 20:47:36 3494 [Note] 第2步：开始解析join on条件:ca.ca_number=sub.sub_number 

2021-09-08 20:47:36 3494 [Note] 第3步：开始选择驱动表,一共有1个候选驱动表 

2021-09-08 20:47:36 3494 [Note] explain select * from tbl_category 

2021-09-08 20:47:36 3494 [Note] 第4步：候选驱动表tbl_category的结果集行数为:29521 

2021-09-08 20:47:36 3494 [Note] 第5步：选择表tbl_category为驱动表 

2021-09-08 20:47:36 3494 [Note] 第6步：表tbl_category 的SQL太逆天,没有优化建议 

2021-09-08 20:47:36 3494 [Note] 第7步：开始验证 字段sub_number是不是主键。表名:tbl_subcategory 

2021-09-08 20:47:36 3494 [Note] show index from tbl_subcategory where Key_name = 'PRIMARY' and Column_name ='sub_number' and Seq_in_index = 1 

2021-09-08 20:47:36 3494 [Note] 第8步：字段sub_number不是主键。表名:tbl_subcategory 

2021-09-08 20:47:36 3494 [Note] 第9步：开始验证 字段sub_number是不是主键。表名:tbl_subcategory 

2021-09-08 20:47:36 3494 [Note] show index from tbl_subcategory where Key_name = 'PRIMARY' and Column_name ='sub_number' and Seq_in_index = 1 

2021-09-08 20:47:36 3494 [Note] 第10步：字段sub_number不是主键。表名:tbl_subcategory 

2021-09-08 20:47:36 3494 [Note] 第11步：开始验证表中是否已存在相关索引。表名:tbl_subcategory, 字段名:sub_number, 在索引中的位置:1 

2021-09-08 20:47:36 3494 [Note] show index from tbl_subcategory where Column_name ='sub_number' and Seq_in_index =1 

2021-09-08 20:47:36 3494 [Note] 第12步：开始输出表tbl_subcategory索引优化建议: 

2021-09-08 20:47:36 3494 [Note] Create_Index_SQL：alter table tbl_subcategory add index idx_sub_number(sub_number) 

2021-09-08 20:47:36 3494 [Note] 第13步: 优化结束!
```

```shell
2021-09-08 20:47:36 3494 [Note] 第12步：开始输出表tbl_subcategory索引优化建议: 

2021-09-08 20:47:36 3494 [Note] Create_Index_SQL：alter table tbl_subcategory add index idx_sub_number(sub_number) 
```

- 执行工具的索引优化建议

```txt
ALTER TABLE tbl_subcategory ADD INDEX idx_sub_number ( sub_number )
```

- 执行sql语句(耗时0.05秒左右`linux系统下的测试`)

```txt
SELECT
	ca_id,
	sub_id,
	ca_number,
	sub_number 
FROM
	tbl_category ca
	LEFT JOIN tbl_subcategory sub ON ca.ca_number = sub.sub_number
```

![执行SQL结果](http://s.siushin.com/siushin/upload/mysql/1631105403228.png)

## 相关阅读

- [MySQL索引](http://www.runoob.com/mysql/mysql-index.html)
- [Mysql索引优化](http://www.runoob.com/w3cnote/mysql-index.html)
- [Mysql explain用法和性能分析](http://blog.csdn.net/u012410733/article/details/66472157)

## 安装SQLAdvisor

- [SQLAdvisor介绍](http://tech.meituan.com/sqladvisor_pr.html?utm_source=tuicool&utm_medium=referral)
- [SQLAdvisor安装](https://github.com/Meituan-Dianping/SQLAdvisor/blob/master/doc/QUICK_START.md)
- [SQLAdvisor安装](http://www.cnblogs.com/ysjChinesePHP/p/6632432.html)